from socket import *
import telnetlib
import struct

p = lambda x: struct.pack('I', x)
up = lambda x: struct.unpack('I', x)[0]

q = lambda x: struct.pack('Q', x)
uq = lambda x: struct.unpack('Q', x)[0]

def rw(t):
    r = ''
    while True:
        c = s.recv(1)
        if not c:
            break
        r += c
        if t in r:
            break
    return r

def interact():
    t = telnetlib.Telnet()
    t.sock = s
    t.interact()

HOST = 'pwnable.kr'
PORT = 9017

while True:
    s = socket(AF_INET, SOCK_STREAM)
    s.connect((HOST, PORT))

    '''
    mov ax, 0x45     
    loop:
        dec ax
        jne loop
    '''

    '''
    shr dx, 40          // qemu always 0x40000000
    loop:
        dec dx
        jne loop
    '''

    check = 0
    failed = False

    rw('A: ')
    s.send('.word 0xb866,0x0100,0xff66,0x75c8,0x90fb\n')
    rw('B: ')
    s.send('.word 0xc148,0x20ea,0xff66,0x75ca,0x90fb\n')

    print '[+] go!!!'
    for i in range(100):
        response = rw(')\n') + rw('\n')
        print response
        if 'wrong' in response:
            check += 1
            if check == 3:
                failed = True
                break
        elif 'suck' in response:
            failed = True
            break

    if failed:
        print '[-] failed!'
        continue

    print s.recv(1024)
    print s.recv(1024)
    print s.recv(1024)
    break


